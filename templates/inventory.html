<!DOCTYPE html>
<html>
<head>
    <title>Inventory Management System</title>
</head>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
        margin: 0;
        padding: 20px;
    }

    h1 {
        text-align: center;
        color: #333;
    }

    h2 {
        margin-top: 20px;
        color: #444;
    }

    form {
        max-width: 400px;
        margin: 0 auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
    }

    label {
        display: block;
        margin-bottom: 8px;
        color: #555;
    }

    input[type="text"],
    input[type="number"],
    input[type="email"],
    input[type="date"] {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 16px;
    }

    input[type="submit"] {
        background-color: #333;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }

    input[type="submit"]:hover {
        background-color: #555;
    }

    button#logoutButton {
        display: block;
        margin: 20px auto;
        background-color: #ff5722;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }

    button#logoutButton:hover {
        background-color: #e64a19;
    }


    #customerContainer {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }

    #customerForm {
        /* flex: 1; */
        margin-right: 20px;
        margin-bottom: 20px;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    #customerInfo {
        flex: 2;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    .customer {
            margin-bottom: 10px;
            border: 1px solid #ddd;
            padding: 10px;
        }


        #fetchDataButton {
    background-color: #113012; /* Green background */
    border: none; /* No borders */
    color: white; /* White text */
    padding: 15px 32px; /* Padding inside the button */
    text-align: center; /* Center-align text */
    text-decoration: none; /* No underline on text */
    display: inline-block; /* Set the display to inline-block */
    font-size: 16px; /* Text font size */
    margin: 4px 2px; /* Margin around the button */
    cursor: pointer; /* Cursor changes to pointer when hovering over the button */
    border-radius: 8px; /* Rounded corners */
    transition: background-color 0.3s, box-shadow 0.3s; /* Smooth transition for hover effects */
}

#fetchDataButton:hover {
    background-color: #45a049; /* Darker shade of green when hovered */
    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2); /* Shadow effect when hovered */
}

#fethsales{
    background-color: #113012; /* Green background */
    border: none; /* No borders */
    color: white; /* White text */
    padding: 15px 32px; /* Padding inside the button */
    text-align: center; /* Center-align text */
    text-decoration: none; /* No underline on text */
    display: inline-block; /* Set the display to inline-block */
    font-size: 16px; /* Text font size */
    margin: 4px 2px; /* Margin around the button */
    cursor: pointer; /* Cursor changes to pointer when hovering over the button */
    border-radius: 8px; /* Rounded corners */
    transition: background-color 0.3s, box-shadow 0.3s; /* Smooth transition for hover effects */
}

#fethsales:hover {
    background-color: #45a049; /* Darker shade of green when hovered */
    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2); /* Shadow effect when hovered */
}




#fethproducts{
    background-color: #113012; /* Green background */
    border: none; /* No borders */
    color: white; /* White text */
    padding: 15px 32px; /* Padding inside the button */
    text-align: center; /* Center-align text */
    text-decoration: none; /* No underline on text */
    display: inline-block; /* Set the display to inline-block */
    font-size: 16px; /* Text font size */
    margin: 4px 2px; /* Margin around the button */
    cursor: pointer; /* Cursor changes to pointer when hovering over the button */
    border-radius: 8px; /* Rounded corners */
    transition: background-color 0.3s, box-shadow 0.3s; /* Smooth transition for hover effects */
}

#fethproducts:hover {
    background-color: #45a049; /* Darker shade of green when hovered */
    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2); /* Shadow effect when hovered */
}


</style>
<body>
    <h1>Inventory Management System</h1>
    <h1>Store The Data In Database</h1>
    
    <div style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 20px; margin: 20px;">
        <!-- First Row -->
        <div style="flex-basis: calc(33.33% - 20px);">
            <h2>Create New Customer</h2>
            <form id="createCustomerForm">
                <label for="name">Name:</label><br>
                <input type="text" id="name" name="name" required><br>
                
                <label for="phone">Phone:</label><br>
                <input type="text" id="phone" name="phone" required><br>
                
                <label for="address">Address:</label><br>
                <input type="text" id="address" name="address" required><br>
                
                <label for="email">Email:</label><br>
                <input type="email" id="email" name="email" required><br><br>
                
                <input type="submit" value="Create Customer">
            </form>
        </div>

        <div style="flex-basis: calc(33.33% - 20px);">
            <h2>Create New Order</h2>
            <form id="createOrderForm">
                <label for="orderDate">Date:</label><br>
                <input type="date" id="orderDate" name="orderDate" required><br>

                <label for="orderCustomerID">Customer ID:</label><br>
                <input type="number" id="orderCustomerID" name="orderCustomerID" required><br>

                <label for="orderEmployeeID">Employee ID:</label><br>
                <input type="number" id="orderEmployeeID" name="orderEmployeeID" required><br>

                <label for="orderCost">Cost:</label><br>
                <input type="number" step="0.01" id="orderCost" name="orderCost" required><br><br>

                <input type="submit" value="Create Order">
            </form>
        </div>

        <!-- Second Row -->
        <div style="flex-basis: calc(33.33% - 20px);">
            <h2>Create New Employee</h2>
            <form id="createEmployeeForm">
                <label for="employeeName">Name:</label><br>
                <input type="text" id="employeeName" name="employeeName" required><br>

                <label for="employeeRole">Role:</label><br>
                <input type="text" id="employeeRole" name="employeeRole" required><br>

                <label for="employeePhone">Phone:</label><br>
                <input type="text" id="employeePhone" name="employeePhone" required><br><br>

                <input type="submit" value="Create Employee">
            </form>
        </div>

        <div style="flex-basis: calc(33.33% - 20px);">
            <h2>Create New Product</h2>
            <form id="createProductForm">
                <label for="productName">Name:</label><br>
                <input type="text" id="productName" name="productName" required><br>

                <label for="productDescription">Description:</label><br>
                <input type="text" id="productDescription" name="productDescription" required><br>

                <label for="productPrice">Price:</label><br>
                <input type="number" step="0.01" id="productPrice" name="productPrice" required><br>

                <label for="productQuantityInStock">Quantity In Stock:</label><br>
                <input type="number" id="productQuantityInStock" name="productQuantityInStock" required><br>

                <label for="productCategoryID">Category ID:</label><br>
                <input type="number" id="productCategoryID" name="productCategoryID" required><br><br>

                <input type="submit" value="Create Product">
            </form>
        </div>

        

        <div style="flex-basis: calc(33.33% - 20px);">
            <h2>Create New Category</h2>
            <form id="createCategoryForm">
                <label for="categoryName">Name:</label><br>
                <input type="text" id="categoryName" name="categoryName" required><br>

                <label for="categoryDescription">Description:</label><br>
                <input type="text" id="categoryDescription" name="categoryDescription" required><br><br>

                <input type="submit" value="Create Category">
            </form>
        </div>
        

        <div style="flex-basis: calc(33.33% - 20px);">
            <h2>Create Order Details</h2>
            <form id="createOrderDetailsForm">
                <label for="orderDetailsOrderID">Order ID:</label><br>
                <input type="number" id="orderDetailsOrderID" name="orderDetailsOrderID" required><br>

                <label for="orderDetailsProductID">Product ID:</label><br>
                <input type="number" id="orderDetailsProductID" name="orderDetailsProductID" required><br>

                <label for="orderDetailsQuantity">Quantity:</label><br>
                <input type="number" id="orderDetailsQuantity" name="orderDetailsQuantity" required><br>

                <label for="orderDetailsPrice">Price:</label><br>
                <input type="number" step="0.01" id="orderDetailsPrice" name="orderDetailsPrice" required><br><br>

                <input type="submit" value="Create Order Details">
            </form>
        </div>
    </div>

    <h1>Perform Analytics</h1>

    <div id="customerContainer">
        <div id="customerForm">
            <h2>Enter Customer ID to Get Information</h2>
            <form id="getCustomerForm">
                <label for="customerId">Customer ID:</label><br>
                <input type="number" id="customerId" name="customerId" required><br><br>
                <input type="submit" value="Get Customer Info">
            </form>
        </div>
    
        <div id="customerInfo">
            <!-- Customer information will be displayed here -->
        </div>
        
        
    </div>
    
    <h1>Customer Total Spent</h1>
    <button id="fetchDataButton">Fetch Customers' Total Spent</button>
    <div id="customersTotalSpent"></div>


    <h1>Top Sales Products</h1>
    <div id="topSalesProducts"></div>
    <button id="fethsales">Fetch Top Sales Products</button>

    <h1>Products with Categories</h1>
    <div id="productsWithCategories"></div>
    <button id="fethproducts">Fetch Products with Categories</button>

    <!-- Logout Button -->
    <button id="logoutButton">Logout</button>


<script>
        // Use the stored token for authentication in API requests
        const token = localStorage.getItem('token');

        // Handle form submission for creating a new customer
        document.getElementById('createCustomerForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            const email = document.getElementById('email').value;

            try {
                const response = await fetch('/create_customers/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ Name: name, Phone: phone, Address: address, Email: email })
                });

                if (response.ok) {
                    const data = await response.json();
                    alert(`Customer created successfully with ID: ${data.CustomerID}`);
                } else {
                    alert('Failed to create customer. Please try again.');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });


    document.getElementById('createCategoryForm').addEventListener('submit', async function(event) {
    event.preventDefault();
    const name = document.getElementById('categoryName').value;
    const description = document.getElementById('categoryDescription').value;

    try {
        const response = await fetch('/create_category/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ Name: name, Description: description })
        });

        if (response.ok) {
            const data = await response.json();
            alert(`Category created successfully with ID: ${data.CategoryID}`);
        } else {
            alert('Failed to create category. Please try again.');
        }
    } catch (error) {
        console.error('Error:', error);
    }
});



    document.getElementById('createProductForm').addEventListener('submit', async function(event) {
    event.preventDefault();
    const name = document.getElementById('productName').value;
    const description = document.getElementById('productDescription').value;
    const price = document.getElementById('productPrice').value;
    const quantityInStock = document.getElementById('productQuantityInStock').value;
    const categoryID = document.getElementById('productCategoryID').value;

    try {
        const response = await fetch('/create_product/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ 
                Name: name, 
                Description: description, 
                Price: parseFloat(price), 
                QuantityInStock: parseInt(quantityInStock), 
                CategoryID: parseInt(categoryID) 
            })
        });

        if (response.ok) {
            const data = await response.json();
            alert(`Product created successfully with ID: ${data.ProductID}`);
        } else {
            alert('Failed to create product. Please try again.');
        }
    } catch (error) {
        console.error('Error:', error);
    }
});

document.getElementById('createEmployeeForm').addEventListener('submit', async function(event) {
    event.preventDefault();
    const name = document.getElementById('employeeName').value;
    const role = document.getElementById('employeeRole').value;
    const phone = document.getElementById('employeePhone').value;

    try {
        const response = await fetch('/create_employee/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ 
                Name: name, 
                Role: role, 
                Phone: phone 
            })
        });

        if (response.ok) {
            const data = await response.json();
            alert(`Employee created successfully with ID: ${data.EmployeeID}`);
        } else {
            alert('Failed to create employee. Please try again.');
        }
    } catch (error) {
        console.error('Error:', error);
    }
});


document.getElementById('createOrderForm').addEventListener('submit', async function(event) {
    event.preventDefault();
    const date = document.getElementById('orderDate').value;
    const customerID = parseInt(document.getElementById('orderCustomerID').value);
    const employeeID = parseInt(document.getElementById('orderEmployeeID').value);
    const cost = parseFloat(document.getElementById('orderCost').value);

    try {
        const response = await fetch('/create_order/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ 
                Date: date, 
                CustomerID: customerID, 
                EmployeeID: employeeID, 
                Cost: cost 
            })
        });

        if (response.ok) {
            const data = await response.json();
            alert(`Order created successfully with ID: ${data.OrderID}`);
        } else {
            alert('Failed to create order. Please try again.');
        }
    } catch (error) {
        console.error('Error:', error);
    }
});


document.getElementById('createOrderDetailsForm').addEventListener('submit', async function(event) {
    event.preventDefault();
    const orderID = parseInt(document.getElementById('orderDetailsOrderID').value);
    const productID = parseInt(document.getElementById('orderDetailsProductID').value);
    const quantity = parseInt(document.getElementById('orderDetailsQuantity').value);
    const price = parseFloat(document.getElementById('orderDetailsPrice').value);

    try {
        const response = await fetch('/create_order_details/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                // Corrected syntax for template literals
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                OrderID: orderID,
                ProductID: productID,
                Quantity: quantity,
                Price: price
            })
        });

        if (response.ok) {
            const data = await response.json();
            alert(`Order Details created successfully with ID: ${data.OrderDetailsID}`);
        } else {
            alert('Failed to create order details. Please try again.');
        }
    } catch (error) {
        console.error('Error:', error);
    }
});

 // Logout functionality
 document.getElementById('logoutButton').addEventListener('click', function() {
            localStorage.removeItem('token');
            window.location.href = '/';
        });

// Handle form submission for getting customer information
document.getElementById('getCustomerForm').addEventListener('submit', async function(event) {
        event.preventDefault();

        const customerId = document.getElementById('customerId').value;
        const token = localStorage.getItem('token'); // Replace with your token retrieval logic

        try {
            const response = await fetch(`/customer_info/${customerId}`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (response.ok) {
                const data = await response.json();

                // Display customer information in the customerInfo div
                const customerInfoDiv = document.getElementById('customerInfo');
                customerInfoDiv.innerHTML = `
                    <h2>Customer Information</h2>
                    <p><strong>Customer ID:</strong> ${data.CustomerID}</p>
                    <p><strong>Name:</strong> ${data.Name}</p>
                    <p><strong>Phone:</strong> ${data.Phone}</p>
                    <p><strong>Address:</strong> ${data.Address}</p>
                    <p><strong>Email:</strong> ${data.Email}</p>
                    <h2>Orders</h2>
                `;

                // Display each order and its details
                for (const order of data.Orders) {
                    customerInfoDiv.innerHTML += `
                        <div class="order">
                            <p><strong>Order ID:</strong> ${order.OrderID}</p>
                            <p><strong>Date:</strong> ${order.Date}</p>
                            <p><strong>Employee:</strong> ${order.Employee.Name} (${order.Employee.Role}) - ${order.Employee.Phone}</p>
                            <p><strong>Cost:</strong> ${order.Cost}</p>
                            <h3>Order Details</h3>
                        `;

                    // Display each order detail
                    for (const detail of order.OrderDetails) {
                        customerInfoDiv.innerHTML += `
                            <div class="order-detail">
                                <p><strong>Product ID:</strong> ${detail.ProductID}</p>
                                <p><strong>Name:</strong> ${detail.Name}</p>
                                <p><strong>Description:</strong> ${detail.Description}</p>
                                <p><strong>Quantity:</strong> ${detail.Quantity}</p>
                                <p><strong>Price:</strong> ${detail.Price}</p>
                            </div>
                        `;
                    }

                    customerInfoDiv.innerHTML += `</div>`;
                }
            } else if (response.status === 404) {
                alert('Customer not found.');
            } else {
                alert('Failed to retrieve customer information. Please try again.');
            }
        } catch (error) {
            console.error('Error:', error);
        }
    });


// Function to fetch total spent by customers
async function fetchCustomersTotalSpent() {
            const token = localStorage.getItem('token'); // Replace with your token retrieval logic
            try {
                const response = await fetch('/customers/total_spent', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayCustomersTotalSpent(data.customers);
                } else {
                    alert('Failed to retrieve customer total spent information. Please try again.');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Function to display customers' total spent
        function displayCustomersTotalSpent(customers) {
            const customersTotalSpentDiv = document.getElementById('customersTotalSpent');
            customersTotalSpentDiv.innerHTML = '';

            for (const customer of customers) {
                const [customerID, name, totalSpent] = customer; // Destructuring the customer array

                customersTotalSpentDiv.innerHTML += `
                    <div class="customer">
                        <h2>${name}</h2>
                        <p><strong>Customer ID:</strong> ${customerID}</p>
                        <p><strong>Total Spent:</strong> $${totalSpent.toFixed(2)}</p>
                    </div>
                `;
            }
        }

        // Event listener for the button
        document.getElementById('fetchDataButton').addEventListener('click', function() {
            fetchCustomersTotalSpent();
        });

        
// Function to fetch top sales products
async function fetchTopSalesProducts() {
            const token = localStorage.getItem('token'); // Replace with your token retrieval logic
            try {
                const response = await fetch('/products/top_sales', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayTopSalesProducts(data.top_products);
                } else {
                    alert('Failed to retrieve top sales products. Please try again.');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

      // Function to display top sales products
function displayTopSalesProducts(products) {
    const topSalesProductsDiv = document.getElementById('topSalesProducts');
    topSalesProductsDiv.innerHTML = '';

    for (const product of products) {
        // Check if the product has all the required fields
        if (product.length === 3) {
            const [ProductID, Name, TotalSold] = product;

            topSalesProductsDiv.innerHTML += `
                <div class="product">
                    <h2>${Name}</h2>
                    <p><strong>Product ID:</strong> ${ProductID}</p>
                    <p><strong>Total Sold:</strong> ${TotalSold}</p>
                </div>
            `;
        } else {
            console.error('Invalid product data:', product);
        }
    }
}



        // Event listener for the button
        document.getElementById('fethsales').addEventListener('click', function() {
            fetchTopSalesProducts();
        });

         // Function to fetch products with categories
         async function fetchProductsWithCategories() {
            const token = localStorage.getItem('token'); // Replace with your token retrieval logic
            try {
                const response = await fetch('/products_with_categories', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayProductsWithCategories(data.products_with_categories);
                } else {
                    alert('Failed to retrieve products with categories. Please try again.');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Function to display products with their categories
        function displayProductsWithCategories(products) {
            const productsWithCategoriesDiv = document.getElementById('productsWithCategories');
            productsWithCategoriesDiv.innerHTML = '';

            for (const product of products) {
                // Assuming each product is a tuple with ProductID, ProductName, and CategoryName
                const [ProductID, ProductName, CategoryName] = product;

                productsWithCategoriesDiv.innerHTML += `
                    <div class="product">
                        <h2>${ProductName}</h2>
                        <p><strong>Product ID:</strong> ${ProductID}</p>
                        <p><strong>Category:</strong> ${CategoryName}</p>
                    </div>
                `;
            }
        }

        // Event listener for the button
        document.getElementById('fethproducts').addEventListener('click', function() {
            fetchProductsWithCategories();
        });

    </script>

    
</body>
</html>